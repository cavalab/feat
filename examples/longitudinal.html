<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="Docutils 0.19: https://docutils.sourceforge.io/" name="generator"/>
  <meta content="width=device-width,initial-scale=1" name="viewport"/>
  <meta content="ie=edge" http-equiv="x-ua-compatible"/>
  <meta content="Copy to clipboard" name="lang:clipboard.copy"/>
  <meta content="Copied to clipboard" name="lang:clipboard.copied"/>
  <meta content="en" name="lang:search.language"/>
  <meta content="True" name="lang:search.pipeline.stopwords"/>
  <meta content="True" name="lang:search.pipeline.trimmer"/>
  <meta content="No matching documents" name="lang:search.result.none"/>
  <meta content="1 matching document" name="lang:search.result.one"/>
  <meta content="# matching documents" name="lang:search.result.other"/>
  <meta content="[\s\-]+" name="lang:search.tokenizer"/>
  <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&amp;display=fallback" rel="stylesheet"/>
  <style>
   body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
  </style>
  <link href="../_static/stylesheets/application.css" rel="stylesheet"/>
  <link href="../_static/stylesheets/application-palette.css" rel="stylesheet"/>
  <link href="../_static/stylesheets/application-fixes.css" rel="stylesheet"/>
  <link href="../_static/fonts/material-icons.css" rel="stylesheet"/>
  <meta content="#2196f3" name="theme-color"/>
  <script src="../_static/javascripts/modernizr.js">
  </script>
  <link href="../_static/icon.jpeg" rel="apple-touch-icon"/>
  <title>
   Using Longitudinal Data ‚Äî FEAT
  </title>
  <link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
  <link href="../_static/material.css" rel="stylesheet" type="text/css"/>
  <link href="../_static/copybutton.css" rel="stylesheet" type="text/css"/>
  <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js">
  </script>
  <script src="../_static/doctools.js">
  </script>
  <script src="../_static/sphinx_highlight.js">
  </script>
  <script src="../_static/clipboard.min.js">
  </script>
  <script src="../_static/copybutton.js">
  </script>
  <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js">
  </script>
  <link href="../genindex.html" rel="index" title="Index"/>
  <link href="../search.html" rel="search" title="Search"/>
  <link href="../py_api.html" rel="next" title="Python API"/>
  <link href="archive.html" rel="prev" title="Using Feat‚Äôs archive"/>
  <link href="../_static/icon.jpeg" rel="apple-touch-icon"/>
 </head>
 <body data-md-color-accent="white" data-md-color-primary="deep" dir="ltr" purple="">
  <svg class="md-svg">
   <defs data-children-count="0">
    <svg height="448" id="__github" viewbox="0 0 416 448" width="416" xmlns="http://www.w3.org/2000/svg">
     <path d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z" fill="currentColor">
     </path>
    </svg>
   </defs>
  </svg>
  <input class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
  <input class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
  <label class="md-overlay" data-md-component="overlay" for="__drawer">
  </label>
  <a class="md-skip" href="#examples/longitudinal" tabindex="1">
   Skip to content
  </a>
  <header class="md-header" data-md-component="header">
   <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
     <div class="md-flex__cell md-flex__cell--shrink">
      <a class="md-header-nav__button md-logo" href="../index.html" title="FEAT">
       <i class="md-icon">
        ùúë
       </i>
      </a>
     </div>
     <div class="md-flex__cell md-flex__cell--shrink">
      <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer">
      </label>
     </div>
     <div class="md-flex__cell md-flex__cell--stretch">
      <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
       <span class="md-header-nav__topic">
        FEAT
       </span>
       <span class="md-header-nav__topic">
        Using Longitudinal Data
       </span>
      </div>
     </div>
     <div class="md-flex__cell md-flex__cell--shrink">
      <label class="md-icon md-icon--search md-header-nav__button" for="__search">
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
       <label class="md-search__overlay" for="__search">
       </label>
       <div class="md-search__inner" role="search">
        <form action="../search.html" class="md-search__form" method="get" name="search">
         <input autocapitalize="off" autocomplete="off" class="md-search__input" data-md-component="query" data-md-state="active" name="q" placeholder="Search" spellcheck="false" type="text"/>
         <label class="md-icon md-search__icon" for="__search">
         </label>
         <button class="md-icon md-search__icon" data-md-component="reset" tabindex="-1" type="reset">
          Óóç
         </button>
        </form>
        <div class="md-search__output">
         <div class="md-search__scrollwrap" data-md-scrollfix="">
          <div class="md-search-result" data-md-component="result">
           <div class="md-search-result__meta">
            Type to start searching
           </div>
           <ol class="md-search-result__list">
           </ol>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <div class="md-flex__cell md-flex__cell--shrink">
      <div class="md-header-nav__source">
       <a class="md-source" data-md-source="github" href="https://github.com/cavalab/feat/" title="Go to repository">
        <div class="md-source__icon">
         <svg height="28" viewbox="0 0 24 24" width="28" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <use height="24" width="24" xlink:href="#__github">
          </use>
         </svg>
        </div>
        <div class="md-source__repository">
         FEAT
        </div>
       </a>
      </div>
     </div>
     <script src="../_static/javascripts/version_dropdown.js">
     </script>
     <script>
      var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
     </script>
    </div>
   </nav>
  </header>
  <div class="md-container">
   <main class="md-main">
    <div class="md-main__inner md-grid" data-md-component="container">
     <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
      <div class="md-sidebar__scrollwrap">
       <div class="md-sidebar__inner">
        <nav class="md-nav md-nav--primary" data-md-level="0">
         <label class="md-nav__title md-nav__title--site" for="__drawer">
          <a class="md-nav__button md-logo" href="../index.html" title="FEAT">
           <i class="md-icon">
            ùúë
           </i>
          </a>
          <a href="../index.html" title="FEAT">
           FEAT
          </a>
         </label>
         <div class="md-nav__source">
          <a class="md-source" data-md-source="github" href="https://github.com/cavalab/feat/" title="Go to repository">
           <div class="md-source__icon">
            <svg height="28" viewbox="0 0 24 24" width="28" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
             <use height="24" width="24" xlink:href="#__github">
             </use>
            </svg>
           </div>
           <div class="md-source__repository">
            FEAT
           </div>
          </a>
         </div>
         <ul class="md-nav__list">
          <li class="md-nav__item">
           <span class="md-nav__link caption">
            <span class="caption-text">
             Getting Started
            </span>
           </span>
          </li>
          <li class="md-nav__item">
           <a class="md-nav__link" href="../install.html">
            Installation
           </a>
          </li>
          <li class="md-nav__item">
           <span class="md-nav__link caption">
            <span class="caption-text">
             User Guide
            </span>
           </span>
          </li>
          <li class="md-nav__item">
           <a class="md-nav__link" href="../guide/overview.html">
            Overview
           </a>
          </li>
          <li class="md-nav__item">
           <a class="md-nav__link" href="../guide/basics.html">
            Basic Usage
           </a>
          </li>
          <li class="md-nav__item">
           <span class="md-nav__link caption">
            <span class="caption-text">
             Examples
            </span>
           </span>
          </li>
          <li class="md-nav__item">
           <a class="md-nav__link" href="command_line.html">
            Command line example
           </a>
          </li>
          <li class="md-nav__item">
           <a class="md-nav__link" href="archive.html">
            Using Feat‚Äôs archive
           </a>
          </li>
          <li class="md-nav__item">
           <input class="md-toggle md-nav__toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
           <label class="md-nav__link md-nav__link--active" for="__toc">
            Using Longitudinal Data
           </label>
           <a class="md-nav__link md-nav__link--active" href="#">
            Using Longitudinal Data
           </a>
           <nav class="md-nav md-nav--secondary">
            <label class="md-nav__title" for="__toc">
             Contents
            </label>
            <ul class="md-nav__list" data-md-scrollfix="">
             <li class="md-nav__item">
              <a class="md-nav__link" href="#examples-longitudinal--page-root">
               Using Longitudinal Data
              </a>
              <nav class="md-nav">
               <ul class="md-nav__list">
                <li class="md-nav__item">
                 <a class="md-nav__link" href="#example-patient-data">
                  Example Patient Data
                 </a>
                </li>
                <li class="md-nav__item">
                 <a class="md-nav__link" href="#cross-validation">
                  Cross validation
                 </a>
                </li>
                <li class="md-nav__item">
                 <a class="md-nav__link" href="#model-interpretation">
                  Model Interpretation
                 </a>
                </li>
                <li class="md-nav__item">
                 <a class="md-nav__link" href="#view-runtime-stats">
                  View runtime stats
                 </a>
                </li>
                <li class="md-nav__item">
                 <a class="md-nav__link" href="#visualizing-the-representation">
                  Visualizing the representation
                 </a>
                </li>
               </ul>
              </nav>
             </li>
             <li class="md-nav__item">
              <a class="md-nav__extra_link" href="../_sources/examples/longitudinal.rst.txt">
               Show Source
              </a>
             </li>
            </ul>
           </nav>
          </li>
          <li class="md-nav__item">
           <span class="md-nav__link caption">
            <span class="caption-text">
             API
            </span>
           </span>
          </li>
          <li class="md-nav__item">
           <a class="md-nav__link" href="../py_api.html">
            Python API
           </a>
          </li>
          <li class="md-nav__item">
           <a class="md-nav__link" href="../cpp_api.html">
            C++ API
           </a>
          </li>
         </ul>
        </nav>
       </div>
      </div>
     </div>
     <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
      <div class="md-sidebar__scrollwrap">
       <div class="md-sidebar__inner">
        <nav class="md-nav md-nav--secondary">
         <label class="md-nav__title" for="__toc">
          Contents
         </label>
         <ul class="md-nav__list" data-md-scrollfix="">
          <li class="md-nav__item">
           <a class="md-nav__link" href="#examples-longitudinal--page-root">
            Using Longitudinal Data
           </a>
           <nav class="md-nav">
            <ul class="md-nav__list">
             <li class="md-nav__item">
              <a class="md-nav__link" href="#example-patient-data">
               Example Patient Data
              </a>
             </li>
             <li class="md-nav__item">
              <a class="md-nav__link" href="#cross-validation">
               Cross validation
              </a>
             </li>
             <li class="md-nav__item">
              <a class="md-nav__link" href="#model-interpretation">
               Model Interpretation
              </a>
             </li>
             <li class="md-nav__item">
              <a class="md-nav__link" href="#view-runtime-stats">
               View runtime stats
              </a>
             </li>
             <li class="md-nav__item">
              <a class="md-nav__link" href="#visualizing-the-representation">
               Visualizing the representation
              </a>
             </li>
            </ul>
           </nav>
          </li>
          <li class="md-nav__item">
           <a class="md-nav__extra_link" href="../_sources/examples/longitudinal.rst.txt">
            Show Source
           </a>
          </li>
          <li class="md-nav__item" id="searchbox">
          </li>
         </ul>
        </nav>
       </div>
      </div>
     </div>
     <div class="md-content">
      <article class="md-content__inner md-typeset" role="main">
       <section id="using-longitudinal-data">
        <h1 id="examples-longitudinal--page-root">
         Using Longitudinal Data
         <a class="headerlink" href="#examples-longitudinal--page-root" title="Permalink to this heading">
          ¬∂
         </a>
        </h1>
        <p>
         This example demonstrates how to do cross validation with longitudinal
data. By
         <em>
          longitudinal
         </em>
         , we mean predictors for specific samples that
have more than one value. This could be time series data or any other
sequential data we might want to model.
        </p>
        <section id="example-patient-data">
         <h2 id="example-patient-data">
          Example Patient Data
          <a class="headerlink" href="#example-patient-data" title="Permalink to this heading">
           ¬∂
          </a>
         </h2>
         <p>
          First, we generate some example data and store it using this script:
          <a class="reference external" href="https://github.com/lacava/feat/blob/master/docs/examples/generate_example_longitudinal_data.py">
           https://github.com/lacava/feat/blob/master/docs/examples/generate_example_longitudinal_data.py
          </a>
          .
         </p>
         <p>
          Let‚Äôs imagine we have patient data from a hospital. This means we have
measurements from different visits, with different numbers of
measurements from different patients collected in non-uniform intervals.
In this example, we make up a risk model in which risk increases for a
patient with an increasing body mass index (BMI) and a high maximum
glucose level in their blood panel.
         </p>
         <div class="highlight-ipython3 notranslate">
          <div class="highlight">
           <pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span>

<span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'data/d_example_patients.csv'</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'target'</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'target'</span><span class="p">]</span>
<span class="n">zfile</span> <span class="o">=</span> <span class="s1">'data/d_example_patients_long.csv'</span>
<span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
</pre>
          </div>
         </div>
         <p>
          Next we set up the learner. We need to declare the longitudinal
operators we want to search over. They are defined as a comma-delimited
list of strings using the
          <code class="docutils literal notranslate">
           <span class="pre">
            functions
           </span>
          </code>
          argument. In this case, the
operators on the second row of the declaration below all operate on
longitudinal data.
         </p>
         <div class="highlight-ipython3 notranslate">
          <div class="highlight">
           <pre><span></span><span class="kn">from</span> <span class="nn">feat</span> <span class="kn">import</span> <span class="n">Feat</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">Feat</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
           <span class="n">max_dim</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
           <span class="n">gens</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
           <span class="n">pop_size</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
           <span class="n">max_time</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="c1"># seconds</span>
           <span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
           <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1"># don't normalize input data</span>
           <span class="n">functions</span><span class="o">=</span><span class="s2">"and,or,not,split,split_c,"</span>
                     <span class="s2">"mean,median,max,min,variance,skew,kurtosis,slope,count"</span><span class="p">,</span>
           <span class="n">backprop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
           <span class="n">iters</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
           <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
           <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
           <span class="n">simplify</span><span class="o">=</span><span class="mf">0.01</span>    <span class="c1"># prune final representations</span>
          <span class="p">)</span>
</pre>
          </div>
         </div>
        </section>
        <section id="cross-validation">
         <h2 id="cross-validation">
          Cross validation
          <a class="headerlink" href="#cross-validation" title="Permalink to this heading">
           ¬∂
          </a>
         </h2>
         <p>
          Cross validation works a little bit differently with longitudinal data.
The block below shows how to train a model using Kfold cross validation.
         </p>
         <div class="highlight-ipython3 notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">scores</span><span class="o">=</span><span class="p">[]</span>

<span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="ow">in</span> <span class="n">kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="c1"># print('train_idx:',train_idx)</span>
    <span class="c1"># note that the train index is passed to FEAT's fit method</span>
    <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span><span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span><span class="n">zfile</span><span class="p">,</span><span class="n">train_idx</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">],</span><span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">],</span><span class="n">zfile</span><span class="p">,</span><span class="n">test_idx</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'scores:'</span><span class="p">,</span><span class="n">scores</span><span class="p">)</span>
</pre>
          </div>
         </div>
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">scores</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0019200502112349603</span><span class="p">,</span> <span class="mf">0.0013323824931506492</span><span class="p">,</span> <span class="mf">0.020377830997444116</span><span class="p">]</span>
</pre>
          </div>
         </div>
        </section>
        <section id="model-interpretation">
         <h2 id="model-interpretation">
          Model Interpretation
          <a class="headerlink" href="#model-interpretation" title="Permalink to this heading">
           ¬∂
          </a>
         </h2>
         <p>
          Now let‚Äôs fit a model to all the data and try to interpret it.
         </p>
         <div class="highlight-ipython3 notranslate">
          <div class="highlight">
           <pre><span></span><span class="c1"># fit to all data</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'fitting longer to all data...'</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">zfile</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)))</span>
</pre>
          </div>
         </div>
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">fitting</span> <span class="n">longer</span> <span class="n">to</span> <span class="nb">all</span> <span class="n">data</span><span class="o">...</span>
</pre>
          </div>
         </div>
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">Feat</span><span class="p">(</span><span class="n">backprop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="s1">'sex,race'</span><span class="p">,</span>
     <span class="n">functions</span><span class="o">=</span><span class="s1">'and,or,not,split,split_c,mean,median,max,min,variance,skew,kurtosis,slope,count'</span><span class="p">,</span>
     <span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_dim</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_time</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
     <span class="n">simplify</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre>
          </div>
         </div>
         <p>
          To see the learned representation, we run
          <code class="docutils literal notranslate">
           <span class="pre">
            clf.get_representation()
           </span>
          </code>
          :
         </p>
         <div class="highlight-ipython3 notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">clf</span><span class="o">.</span><span class="n">get_representation</span><span class="p">()</span>
</pre>
          </div>
         </div>
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="s1">'[slope(z_bmi)][max(z_glucose)]'</span>
</pre>
          </div>
         </div>
         <p>
          Here our final representation is composed of
          <code class="docutils literal notranslate">
           <span class="pre">
            slope(z_bmi)
           </span>
          </code>
          and
          <code class="docutils literal notranslate">
           <span class="pre">
            max(z_glucose)
           </span>
          </code>
          , both of which we know to be correct features for
this simulated dataset. The best training representation displays clear
overfitting, highlighting the importance of using archive validation for
model selection. We can also look at the representation with the model
weights, sorted by magnitude, using
          <code class="docutils literal notranslate">
           <span class="pre">
            clf.get_model()
           </span>
          </code>
          :
         </p>
         <div class="highlight-ipython3 notranslate">
          <div class="highlight">
           <pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">get_model</span><span class="p">())</span>
</pre>
          </div>
         </div>
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">Weight</span>      <span class="n">Feature</span>
<span class="mf">8.23132</span>     <span class="n">offset</span>
<span class="mf">0.80</span>        <span class="n">slope</span><span class="p">(</span><span class="n">z_bmi</span><span class="p">)</span>
<span class="mf">0.73</span>        <span class="nb">max</span><span class="p">(</span><span class="n">z_glucose</span><span class="p">)</span>
</pre>
          </div>
         </div>
        </section>
        <section id="view-runtime-stats">
         <h2 id="view-runtime-stats">
          View runtime stats
          <a class="headerlink" href="#view-runtime-stats" title="Permalink to this heading">
           ¬∂
          </a>
         </h2>
         <p>
          FEAT stores statistics about the training procedure in a dictionary
          <code class="docutils literal notranslate">
           <span class="pre">
            clf.stats_
           </span>
          </code>
          . An example of plotting from this dictionary is shown
below.
         </p>
         <div class="highlight-ipython3 notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">clf</span><span class="o">.</span><span class="n">stats_</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre>
          </div>
         </div>
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">dict_keys</span><span class="p">([</span><span class="s1">'generation'</span><span class="p">,</span> <span class="s1">'med_complexity'</span><span class="p">,</span> <span class="s1">'med_dim'</span><span class="p">,</span> <span class="s1">'med_loss'</span><span class="p">,</span> <span class="s1">'med_loss_v'</span><span class="p">,</span> <span class="s1">'med_num_params'</span><span class="p">,</span> <span class="s1">'med_size'</span><span class="p">,</span> <span class="s1">'min_loss'</span><span class="p">,</span> <span class="s1">'min_loss_v'</span><span class="p">,</span> <span class="s1">'time'</span><span class="p">])</span>
</pre>
          </div>
         </div>
         <div class="highlight-ipython3 notranslate">
          <div class="highlight">
           <pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">stats_</span><span class="p">[</span><span class="s1">'time'</span><span class="p">],</span> <span class="n">clf</span><span class="o">.</span><span class="n">stats_</span><span class="p">[</span><span class="s1">'min_loss'</span><span class="p">],</span> <span class="s1">'b'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'training loss'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">stats_</span><span class="p">[</span><span class="s1">'time'</span><span class="p">],</span> <span class="n">clf</span><span class="o">.</span><span class="n">stats_</span><span class="p">[</span><span class="s1">'min_loss_v'</span><span class="p">],</span> <span class="s1">'r'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'validation loss'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Time (s)'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'MSE'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
</pre>
          </div>
         </div>
         <img alt="../_images/output_14_0.png" src="../_images/output_14_0.png"/>
         <div class="highlight-ipython3 notranslate">
          <div class="highlight">
           <pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">stats_</span><span class="p">[</span><span class="s1">'time'</span><span class="p">],</span> <span class="n">clf</span><span class="o">.</span><span class="n">stats_</span><span class="p">[</span><span class="s1">'med_complexity'</span><span class="p">],</span> <span class="s1">'b'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'median complexity'</span><span class="p">)</span>
<span class="c1"># plt.plot(clf.stats_['time'], clf.stats_['med_size'], 'r', label='median size')</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Time (s)'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Median Complexity'</span><span class="p">)</span>
<span class="c1"># plt.gca().set_yscale('log')</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
</pre>
          </div>
         </div>
         <img alt="../_images/output_15_0.png" src="../_images/output_15_0.png"/>
        </section>
        <section id="visualizing-the-representation">
         <h2 id="visualizing-the-representation">
          Visualizing the representation
          <a class="headerlink" href="#visualizing-the-representation" title="Permalink to this heading">
           ¬∂
          </a>
         </h2>
         <p>
          Here we take the two relevant features and plot the data with them. This
shows us the risk surface as a function of these learned features.
         </p>
         <div class="highlight-ipython3 notranslate">
          <div class="highlight">
           <pre><span></span><span class="c1"># Visualize the representation</span>

<span class="n">proj</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">zfile</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'proj:'</span><span class="p">,</span><span class="n">proj</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.patheffects</span> <span class="k">as</span> <span class="nn">PathEffects</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>

<span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">'RdBu'</span><span class="p">)</span>
<span class="c1"># We choose a color palette with seaborn.</span>
<span class="c1"># palette = np.array(sns.color_palette("cividis", np.unique(y)))</span>

<span class="c1"># We create a scatter plot.</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">aspect</span><span class="o">=</span><span class="s1">'equal'</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">proj</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">proj</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                <span class="n">c</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<span class="c1"># sc.colorbar()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">'square'</span><span class="p">)</span>
<span class="c1"># ax.axis('off')</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">'tight'</span><span class="p">)</span>

<span class="c1"># add labels from representation</span>
<span class="n">rep</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'['</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">clf</span><span class="o">.</span><span class="n">get_representation</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">']'</span><span class="p">)</span> <span class="k">if</span> <span class="n">r</span> <span class="o">!=</span> <span class="s1">''</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'rep:'</span><span class="p">,</span><span class="n">rep</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">rep</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">rep</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># plt.savefig('longitudinal_representation.svg', dpi=120)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
          </div>
         </div>
         <div class="highlight-default notranslate">
          <div class="highlight">
           <pre><span></span><span class="n">proj</span><span class="p">:</span> <span class="p">(</span><span class="mi">993</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">rep</span><span class="p">:</span> <span class="p">[</span><span class="s1">'slope(z_bmi)'</span><span class="p">,</span> <span class="s1">'max(z_glucose)'</span><span class="p">]</span>
</pre>
          </div>
         </div>
         <img alt="../_images/output_17_1.png" src="../_images/output_17_1.png"/>
        </section>
       </section>
      </article>
     </div>
    </div>
   </main>
  </div>
  <footer class="md-footer">
   <div class="md-footer-nav">
    <nav class="md-footer-nav__inner md-grid">
     <a class="md-flex md-footer-nav__link md-footer-nav__link--prev" href="archive.html" rel="prev" title="Using Feat‚Äôs archive">
      <div class="md-flex__cell md-flex__cell--shrink">
       <i class="md-icon md-icon--arrow-back md-footer-nav__button">
       </i>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
       <span class="md-flex__ellipsis">
        <span class="md-footer-nav__direction">
         Previous
        </span>
        Using Feat‚Äôs archive
       </span>
      </div>
     </a>
     <a class="md-flex md-footer-nav__link md-footer-nav__link--next" href="../py_api.html" rel="next" title="Python API">
      <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
       <span class="md-flex__ellipsis">
        <span class="md-footer-nav__direction">
         Next
        </span>
        Python API
       </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
       <i class="md-icon md-icon--arrow-forward md-footer-nav__button">
       </i>
      </div>
     </a>
    </nav>
   </div>
   <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
     <div class="md-footer-copyright">
      <div class="md-footer-copyright__highlight">
       ¬© Copyright 2016, William La Cava, Tilak Raj Singh, University of Pennsylvania.
      </div>
      Created using
      <a href="http://www.sphinx-doc.org/">
       Sphinx
      </a>
      6.1.3.
             and
      <a href="https://github.com/bashtage/sphinx-material/">
       Material for
              Sphinx
      </a>
     </div>
    </div>
   </div>
  </footer>
  <script src="../_static/javascripts/application.js">
  </script>
  <script>
   app.initialize({version: "1.0.4", url: {base: ".."}})
  </script>
 </body>
</html>